<!-- X500 Quadrotor Model for PX4 SITL Integration -->
<!-- Frame: X-configuration, matching PX4 motor layout -->
<!-- Coordinate System: Z-up (converted to NED for MAVLink) -->

<mujoco model="quadrotor_x500">
  <compiler angle="radian" coordinate="local" inertiafromgeom="false"/>
  
  <option timestep="0.002" gravity="0 0 -9.81" integrator="RK4">
    <flag warmstart="enable"/>
  </option>
  
  <default>
    <joint armature="0.001" damping="0.01"/>
    <geom contype="1" conaffinity="1" friction="0.8 0.02 0.01"/>
    <motor ctrllimited="true" ctrlrange="0 1"/>
  </default>
  
  <asset>
    <!-- Ground texture -->
    <texture type="2d" name="grid" builtin="checker" rgb1="0.1 0.2 0.3" rgb2="0.2 0.3 0.4" 
             width="512" height="512" mark="edge" markrgb="0.2 0.3 0.4"/>
    <material name="grid" texture="grid" texrepeat="8 8" reflectance="0.1"/>
    
    <!-- Drone materials -->
    <material name="body_mat" rgba="0.2 0.2 0.2 1"/>
    <material name="arm_mat" rgba="0.3 0.3 0.3 1"/>
    <material name="prop_cw_mat" rgba="0.8 0.2 0.2 1"/>
    <material name="prop_ccw_mat" rgba="0.2 0.2 0.8 1"/>
    <material name="motor_mat" rgba="0.4 0.4 0.4 1"/>
    
    <!-- Target marker material -->
    <material name="target_mat" rgba="1.0 0.2 0.2 0.8" emission="0.5"/>
    <material name="target_glow_mat" rgba="1.0 0.5 0.0 0.3"/>
  </asset>
  
  <worldbody>
    <!-- Ground plane -->
    <geom name="ground" type="plane" size="50 50 0.1" material="grid" conaffinity="1" contype="1"/>
    
    <!-- Light sources -->
    <light name="spotlight" mode="targetbodycom" target="quadrotor" 
           diffuse="0.8 0.8 0.8" specular="0.3 0.3 0.3" pos="0 -2 4" cutoff="30"/>
    <light name="ambient" directional="true" diffuse="0.4 0.4 0.4" pos="0 0 5"/>
    
    <!-- Target marker (mocap body - can be moved without physics) -->
    <body name="target" mocap="true" pos="3 0 1">
      <geom name="target_sphere" type="sphere" size="0.15" material="target_mat" 
            contype="0" conaffinity="0"/>
      <geom name="target_glow" type="sphere" size="0.25" material="target_glow_mat"
            contype="0" conaffinity="0"/>
    </body>
    
    <!-- Quadrotor body -->
    <body name="quadrotor" pos="0 0 0.5">
      <!-- Free joint for 6-DOF motion -->
      <freejoint name="root"/>
      
      <!-- Inertial properties (X500 frame) -->
      <inertial pos="0 0 0" mass="2.0" 
                diaginertia="0.029125 0.029125 0.055225"/>
      
      <!-- Central body (hub) -->
      <geom name="body_center" type="box" size="0.08 0.08 0.03" 
            material="body_mat" mass="0"/>
      
      <!-- Arms (X-configuration) -->
      <!-- Front-Right arm -->
      <geom name="arm_fr_geom" type="capsule" size="0.015 0.125"
            pos="0.0884 0.0884 0" euler="0 1.5708 0.785"
            material="arm_mat" mass="0"/>
            
      <!-- Front-Left arm -->
      <geom name="arm_fl_geom" type="capsule" size="0.015 0.125"
            pos="-0.0884 0.0884 0" euler="0 1.5708 -0.785"
            material="arm_mat" mass="0"/>
            
      <!-- Back-Left arm -->
      <geom name="arm_bl_geom" type="capsule" size="0.015 0.125"
            pos="-0.0884 -0.0884 0" euler="0 1.5708 0.785"
            material="arm_mat" mass="0"/>
            
      <!-- Back-Right arm -->
      <geom name="arm_br_geom" type="capsule" size="0.015 0.125"
            pos="0.0884 -0.0884 0" euler="0 1.5708 -0.785"
            material="arm_mat" mass="0"/>
      
      <!-- Motor 1: Front-Right (CCW, positive yaw torque) -->
      <body name="motor1" pos="0.1768 0.1768 0.02">
        <geom name="motor1_body" type="cylinder" size="0.02 0.015" 
              material="motor_mat" mass="0"/>
        <geom name="prop1" type="cylinder" size="0.1 0.005" pos="0 0 0.02"
              material="prop_ccw_mat" mass="0" contype="0" conaffinity="0"/>
        <!-- Thrust force application site -->
        <site name="thrust1" pos="0 0 0.025" size="0.01"/>
      </body>
      
      <!-- Motor 2: Front-Left (CW, negative yaw torque) -->
      <body name="motor2" pos="-0.1768 0.1768 0.02">
        <geom name="motor2_body" type="cylinder" size="0.02 0.015" 
              material="motor_mat" mass="0"/>
        <geom name="prop2" type="cylinder" size="0.1 0.005" pos="0 0 0.02"
              material="prop_cw_mat" mass="0" contype="0" conaffinity="0"/>
        <site name="thrust2" pos="0 0 0.025" size="0.01"/>
      </body>
      
      <!-- Motor 3: Back-Left (CCW, positive yaw torque) -->
      <body name="motor3" pos="-0.1768 -0.1768 0.02">
        <geom name="motor3_body" type="cylinder" size="0.02 0.015" 
              material="motor_mat" mass="0"/>
        <geom name="prop3" type="cylinder" size="0.1 0.005" pos="0 0 0.02"
              material="prop_ccw_mat" mass="0" contype="0" conaffinity="0"/>
        <site name="thrust3" pos="0 0 0.025" size="0.01"/>
      </body>
      
      <!-- Motor 4: Back-Right (CW, negative yaw torque) -->
      <body name="motor4" pos="0.1768 -0.1768 0.02">
        <geom name="motor4_body" type="cylinder" size="0.02 0.015" 
              material="motor_mat" mass="0"/>
        <geom name="prop4" type="cylinder" size="0.1 0.005" pos="0 0 0.02"
              material="prop_cw_mat" mass="0" contype="0" conaffinity="0"/>
        <site name="thrust4" pos="0 0 0.025" size="0.01"/>
      </body>
      
      <!-- IMU sensor site (at center of mass) -->
      <site name="imu" pos="0 0 0" size="0.01"/>
      
      <!-- GPS antenna site (top of body) -->
      <site name="gps" pos="0 0 0.04" size="0.01"/>
      
      <!-- Barometer site -->
      <site name="baro" pos="0 0 0.02" size="0.005"/>
      
      <!-- Magnetometer site -->
      <site name="mag" pos="0 0 0" size="0.005"/>
      
      <!-- Camera sites (optional) -->
      <site name="camera_front" pos="0.1 0 -0.02" euler="0 0.3 0" size="0.01"/>
      <site name="camera_down" pos="0 0 -0.04" euler="1.5708 0 0" size="0.01"/>
    </body>
  </worldbody>
  
  <!-- Sensors -->
  <sensor>
    <!-- IMU sensors -->
    <gyro name="gyro" site="imu" noise="0.001"/>
    <accelerometer name="accel" site="imu" noise="0.01"/>
    
    <!-- Position/velocity sensors (for ground truth) -->
    <framepos name="pos" objtype="site" objname="imu"/>
    <framequat name="quat" objtype="site" objname="imu"/>
    <framelinvel name="linvel" objtype="site" objname="imu"/>
    <frameangvel name="angvel" objtype="site" objname="imu"/>
    
    <!-- Magnetometer -->
    <magnetometer name="mag" site="mag" noise="0.01"/>
  </sensor>
  
  <!-- Actuators (motors) -->
  <!-- Each motor produces thrust force along body Z-axis -->
  <!-- Control range 0-1 maps to 0 to max_thrust (8N per motor) -->
  <actuator>
    <!-- Motor 1: Front-Right (CCW) -->
    <general name="motor1" site="thrust1" gear="0 0 8 0 0 0.08"
             ctrllimited="true" ctrlrange="0 1" dyntype="filter" dynprm="0.02"/>
    
    <!-- Motor 2: Front-Left (CW) -->
    <general name="motor2" site="thrust2" gear="0 0 8 0 0 -0.08"
             ctrllimited="true" ctrlrange="0 1" dyntype="filter" dynprm="0.02"/>
    
    <!-- Motor 3: Back-Left (CCW) -->
    <general name="motor3" site="thrust3" gear="0 0 8 0 0 0.08"
             ctrllimited="true" ctrlrange="0 1" dyntype="filter" dynprm="0.02"/>
    
    <!-- Motor 4: Back-Right (CW) -->
    <general name="motor4" site="thrust4" gear="0 0 8 0 0 -0.08"
             ctrllimited="true" ctrlrange="0 1" dyntype="filter" dynprm="0.02"/>
  </actuator>
</mujoco>
